apiVersion: networking.k8s.io/v1 # SpÃ©cifie la version de l'API Kubernetes utilisÃ©e pour Ingress.
kind: Ingress # Indique qu'on dÃ©finit une ressource de type Ingress.

metadata:
  name: ingress-service # Nom de l'Ingress, utilisÃ© pour l'identifier dans le cluster.
  annotations:
    ingressClassName: nginx # SpÃ©cifie que l'on utilise le contrÃ´leur Ingress basÃ© sur NGINX.
    nginx.ingress.kubernetes.io/use-regex: 'true' # Active l'utilisation des expressions rÃ©guliÃ¨res dans les chemins.
    # nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: tickets.dev # SpÃ©cifie que cet Ingress est actif pour le domaine "tickets.dev".
      http:
        paths:
          - pathType: Prefix # DÃ©finit le type de correspondance du chemin (Prefix = commence par).
            path: /api/users/?(.*) # Capture toutes les routes sous "/api/users/", ex: /api/users/login, /api/users/signup
            backend:
              service:
                name: auth-srv # Redirige les requÃªtes vers le service Kubernetes nommÃ© "auth-srv".
                port:
                  number: 3000 # Le service "auth-srv" Ã©coute sur le port 3000.
          - pathType: Prefix
            path: /?(.*)
            backend:
              service:
                name: client-srv
                port:
                  number: 3000
# ===========================
# ğŸ“Œ EXPLICATION DU FONCTIONNEMENT
# ===========================

# Cet Ingress permet d'exposer le service "auth-srv" sous le domaine "tickets.dev".
# Toute requÃªte commenÃ§ant par "/api/users/" sera envoyÃ©e au service "auth-srv" sur le port 3000.

# ğŸ¯ Exemple de requÃªtes et leur redirection :
# - `GET tickets.dev/api/users/login`   â†’ `auth-srv:3000/api/users/login`
# - `POST tickets.dev/api/users/signup` â†’ `auth-srv:3000/api/users/signup`
# - `GET tickets.dev/api/orders/123`    âŒ (pas pris en charge par cet Ingress)

# ğŸ› ï¸ Pourquoi utiliser Ingress ?
# âœ… Centralise l'accÃ¨s aux services via un domaine unique.
# âœ… Ã‰vite d'exposer chaque service avec un LoadBalancer ou un NodePort.
# âœ… Facilite la configuration de la sÃ©curitÃ© (SSL, Auth, etc.).
# âœ… Optimise la gestion du trafic HTTP avec un contrÃ´leur comme NGINX.

# ğŸ”— SchÃ©ma du flux des requÃªtes :
# Client (navigateur, app) â†’ Ingress Controller (NGINX) â†’ Service Kubernetes â†’ Pod (Application)
